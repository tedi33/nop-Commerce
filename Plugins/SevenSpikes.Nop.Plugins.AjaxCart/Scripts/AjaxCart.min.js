/*
* Copyright 2014 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

$(document).ready(function () { (function (e, b, p) { function m() { var a = A(), c = a.buttonsParameters; if (0 < c.length) { var d = b.getAttrValFromDom(".ajaxCartInfo", "data-getAjaxCartButtonUrl"); b.ajax({ cache: !1, type: "POST", data: b.toJSON(c), contentType: "application/json; charset=utf-8", url: d, success: function (c) { if ("" != c) for (var f = 0; f < a.addToCartButtons.length; f++) { var d = a.addToCartButtons[f], l = b(c).filter("div[data-productId='" + d.productId + "']"); if (l && 0 < l.length) { var e = b.getAttrValFromDom(l, "data-isProductPage"); e && e == d.isProductPage.toString() && b(d.buttonElement).replaceWith(l[0]) } } }, error: function (b, a, c) { } }) } } function B(a) { if (!e.waitForAjaxRequest) { e.waitForAjaxRequest = !0; var c = b.getHiddenValFromDom("#checkProductAttributesUrl"), d = b.getAttrValFromDom(a.currentTarget, "data-productId"), g = q(a.currentTarget), d = { productId: d, quantity: g }; r(); b.ajax({ cache: !1, type: "POST", dataType: "json", data: b.toJSON(d), contentType: "application/json; charset=utf-8", url: c, success: function (b) { s(b, a, !1) }, error: function (b, c, d) { s(data, a, !0) } }) } } function s(a, c, d) { var g = b.getHiddenValFromDom("#addProductToCartUrl"), f = b.getAttrValFromDom(c.currentTarget, "data-productId"), h = q(c.currentTarget); c = { productId: f, quantity: h }; d ? (k(), e.waitForAjaxRequest = !1) : a.HasProductAttributes ? (C(f, h), k(), e.waitForAjaxRequest = !1) : b.ajax({ cache: !1, type: "POST", dataType: "json", data: b.toJSON(c), contentType: "application/json; charset=utf-8", url: g, success: function (a) { k(); e.waitForAjaxRequest = !1; "success" == a.Status ? (t(), u(), v(), w(h), x(a.ProductAddedToCartWindow), b.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" })) : "warning" == a.Status ? y(a.AddToCartWarnings) : "error" == a.Status && y(a.ErrorMessage) }, error: function (b, a, c) { k(); e.waitForAjaxRequest = !1 } }) } function D(a, c) { c == p && (c = !1); if (!e.waitForAjaxRequest) { e.waitForAjaxRequest = !0; var d = b(a.currentTarget), g = b.getHiddenValFromDom("#addProductVariantToCartUrl"), f = b.getAttrValFromDom(a.currentTarget, "data-productId"), h = E(d), d = b(d).closest("form").serialize(); 0 == d.length && (formSelector = b("body").find("form"), d = b(formSelector).serialize()); 0 != d.length && (d += "&"); d += "productId=" + f; c ? F() : r(); b.ajax({ cache: !1, type: "POST", data: d, url: g, success: function (a) { if ("warning" == a.Status || "error" == a.Status) { n(c); e.waitForAjaxRequest = !1; var d = a.AddToCartWarnings; a = a.PopupTitle; if (c) b(".miniProductDetailsView .message-error").html(d); else { var f = b(".addProductVariantToCartErrors").data("kendoWindow"); f || (f = b(".addProductVariantToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", modal: !0, actions: ["Close"], animation: !1, visible: !1, title: a }).data("kendoWindow"), f.wrapper.addClass("ajaxCart")); f.content(d); f.center(); f.open() } } else t(), v(), w(h), u(), c && b(".miniProductDetailsView").data("kendoWindow").close(), n(c), e.waitForAjaxRequest = !1, x(a.ProductAddedToCartWindow), b.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" }) }, error: function (b, a, d) { n(c); e.waitForAjaxRequest = !1 } }) } } function A() { var a = b.getAttrValFromDom(".ajaxCartInfo", "data-productPageAddToCartButtonSelector"), c = b.getAttrValFromDom(".ajaxCartInfo", "data-productBoxAddToCartButtonSelector"), d = [], e = []; b(a).each(function () { if (!b(this).is(".nopAjaxCartProductVariantAddToCartButton")) { var a = b.getAttrValFromDom(this, "data-productid", 0); if (a && 0 < a) { var c = { productId: a, isProductPage: !0, buttonElement: b(this) }, a = { productId: a, isProductPage: !0, buttonValue: z(b(this)) }; d.push(c); e.push(a) } } }); b(c).each(function () { if (!b(this).is(".nopAjaxCartProductListAddToCartButton")) { var a; var c = b(this); a = b.getAttrValFromDom(".ajaxCartInfo", "data-productBoxProductItemElementSelector"); a = a == p || "" == a ? 0 : b.getAttrValFromDom(b(c).parents(a), "data-productid", 0); a && 0 < a && (c = { productId: a, isProductPage: !1, buttonElement: b(this) }, a = { productId: a, isProductPage: !1, buttonValue: z(b(this)) }, d.push(c), e.push(a)) } }); return { addToCartButtons: d, buttonsParameters: e } } function z(a) { return b.getAttrValFromDom(a, "value") } function n(a) { a ? b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").hide() : k() } function F() { if (0 < b(".miniProductDetailsView").length) { var a = b(".miniProductDetailsView").parent().height(), c = b(".miniProductDetailsView").parent().width(); b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").height(a - 10); b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").width(c - 10); b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").show() } } function E(a) { var c = 1; a = b.getAttrValFromDom(a, "data-productId"); "" != a && (a = "#addtocart_" + a + "_EnteredQuantity", 0 < b(a).length && (a = b(a).val(), 0 < a && (c = a))); return c } function y(a) { var c = b(".addProductToCartErrors").data("kendoWindow"); c || (c = b(".addProductToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", height: "100px", modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"), c.wrapper.addClass("ajaxCart")); c.content(a); c.center(); c.open() } function x(a) { b(".productAddedToCartWindow").html(b(a).html()); a = b(".productAddedToCartWindow").data("kendoWindow"); a.center(); a.open() } function w(a) { var c = '.header-links a[href="/cart"]', d = b.getHiddenValFromDom("#shoppingCartMenuLinkSelector"); 0 < b("#shoppingCartMenuLinkSelector").length && "" != d && (c = d, c = b("<div/>").html(c).text()); c = b(c).filter(":last"); 0 < c.length && (d = c.html(), d = /\d+/.exec(d), a = parseInt(d) + parseInt(a), c.html("(" + a + ")")) } function v() { var a = b.getHiddenValFromDom("#shoppingCartBoxUrl"), c = b.getHiddenValFromDom("#shoppingCartBoxPanelSelector"); 0 < b(c).length && b.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = b(a).filter(c); b(c).replaceWith(a) }, error: function (a, b, c) { } }) } function u() { var a = b.getHiddenValFromDom("#flyoutShoppingCartUrl"), c = b.getHiddenValFromDom("#flyoutShoppingCartPanelSelector"); 0 < b(c).length && b.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = b(a).filter(c); b(c).replaceWith(a) }, error: function (a, b, c) { } }) } function t() { var a = b.getHiddenValFromDom("#miniShoppingCartUrl"); 0 < b(".block.block-shoppingcart").length && b.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = b(a).filter(".block.block-shoppingcart"); b(".block.block-shoppingcart").replaceWith(a) }, error: function (a, b, e) { } }) } function C(a, c) { var d = { productId: a }, e = b.getHiddenValFromDom("#getMiniProductDetailsViewUrl"); b.ajax({ cache: !1, async: !1, type: "POST", data: b.toJSON(d), contentType: "application/json; charset=utf-8", url: e, success: function (a) { a = '<div class="miniProductDetailsPanelAjaxBusy"></div><div class="clear"></div>' + a; a = b(".miniProductDetailsView").data("kendoWindow").content(a); a.center(); a.open(); a = b.getAttrValFromDom(".miniProductDetailsView .miniProductDetailsViewAddToCartButton", "data-productId", 0); 0 < a && (a = ".miniProductDetailsView #addtocart_" + a + "_EnteredQuantity", 0 < b(a).length && b(a).val(c)) }, error: function (a, b, c) { } }) } function q(a) { var c = 1; a = b.getAttrValFromDom(a, "data-productId"); "" != a && (a = "#productQuantity" + a, 0 < b(a).length && (a = b(a).val(), 0 < a && (c = a))); return c } function r() { var a = b("body"); if (0 < a.length) { var c = a.height(), a = a.width(); b(".nopAjaxCartPanelAjaxBusy").height(c); b(".nopAjaxCartPanelAjaxBusy").width(a); b(".nopAjaxCartPanelAjaxBusy").show() } } function k() { b(".nopAjaxCartPanelAjaxBusy").hide() } e.waitForAjaxRequest = !1; e.closeProductAddedToCartWindow = function () { var a = b(".productAddedToCartWindow").data("kendoWindow"); a && a.close() }; m(); (function () { var a = b("body"); 0 == a.find(".nopAjaxCartPanelAjaxBusy").length && (a.prepend('<div class="nopAjaxCartPanelAjaxBusy"></div>'), b(".nopAjaxCartPanelAjaxBusy").hide()) })(); (function () { var a = b("body"); 0 < a.length && (a.prepend('<div class="productAddedToCartWindow"></div>'), a.prepend('<div class="miniProductDetailsView"></div>'), a.prepend('<div class="addProductVariantToCartErrors"></div>'), a.prepend('<div class="addProductToCartErrors"></div>'), b(".miniProductDetailsView").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow").wrapper.addClass("ajaxCart")); b(".productAddedToCartWindow").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow").wrapper.addClass("ajaxCart") })(); b("body").on("click", ".nopAjaxCartProductListAddToCartButton", function (a) { B(a) }); b("body").on("click", ".nopAjaxCartProductVariantAddToCartButton", function (a) { var c = !1; b(this).hasClass("miniProductDetailsViewAddToCartButton") && (c = !0); D(a, c) }); b(document).on("nopAjaxFiltersFiltrationCompleteEvent", m); b(document).on("nopQuickViewDataShownEvent", m) })(window.nopAjaxCart = window.nopAjaxCart || {}, jQuery) });
